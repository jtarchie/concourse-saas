#!/usr/bin/env ruby

require 'yaml'
require_relative '../app/models/atc_endpoint'
require_relative '../app/pipelines/main'
require_relative '../app/repositories/repos'

uri, username, password = *ARGV

fail 'usage: ./bin/generate-pipeline <uri> <username> <password>' if [uri, username, password].any?(&:nil?)

source = Models::Repo.new(uri: 'https://github.com/jtarchie/concourse-saas')
atc_endpoint = Models::ATCEndpoint.new(
  uri: uri,
  username: username,
  password: password
)

manifest = Pipeline::Main.new(
  repos: Repositories::Repos.all,
  source: source,
  atc_endpoint: atc_endpoint
)

puts manifest.to_h.to_yaml
